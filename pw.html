<html>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
<script src="json2.js"></script>
<script type="text/javascript" src="RollCake.js"></script>
<script type="text/javascript">
(function($){
    $(document).ready(function(){    
        var con = RollCake.rcpConnection();
        var Pass = function(){return True;};
		var onReceive = function(raw_cmd_str, cmd){
			$('#debug_log').prepend('<div class = "msg">'+raw_cmd_str+'</div>');

			if (cmd.command === 'appendValue'){
				$('#result').prepend('<div class = "msg">'+cmd.value.username+":"+cmd.value.message+'</div>');
			}
			else if (cmd.command === 'caution'){
				if(cmd.cause === 'logintUser'){
					$('#login_result').val() = 'failure.';
				}
			}
			else if (cmd.command === 'info'){
				if(cmd.cause === 'logintUser'){
					$('#login_create').hide();
				}
			}

		}
		//var host_address = "192.168.11.27"
		var host_address = "www.tuna-cat.com"
        con.connectToServer(host_address,4001,Pass,Pass,onReceive,Pass);
       

        $('#createUser_button').click(function(){
			con.createUser($('#username').val(), $('#password').val());
			$('#message_text').val("");
        });
        
		$('#login_button').click(function(){
			con.loginUser($('#username').val(), $('#password').val());
			$('#message_text').val("");
        });

		var send_message = function(){
			if ($('#message_text'.is(':empty')))
			{
				return;	
			}
			else
			{
				cmd = {
					command:'appendValue',
					value:{
						username:$('#handlename').val(),
						message:$('#message_text').val()
					}
				}
				con.sendCommand(cmd);
				$('#message_text').val("");
			}
        }

        $('#send_button').click(send_message);
		
		$('#message_text').keyup(function(e){
			if (e.keyCode === 13){
				send_message();
			}
		})
        
    });

})(jQuery);
</script>
<head>
<title>test</title>
</head>
<body>
<div id="login_and_create">
	<table>
		<tr><td>name:</td><td><input type="text" id="username"></td></tr><br />
		<tr><td>pass:</td><td><input type="password" id="password"><button id="login_button">login</button><button id="createUser_button">create</button></td></tr><br />
	</table>
</div>
<div id="login_result"></div><br />
<br />
<input type="text" id="handlename"><br />
<textarea id="message_text"></textarea>
<button id="send_button">send</button>
<div id="result"></div><br />
<div id="debug_log"></div>
</body>
</html>
