<html>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
<script src="json2.js"></script>
<script type="text/javascript" src="RollCake.js"></script>
<script type="text/javascript">
(function($){
    $(document).ready(function(){    
        var con = RollCake.rcpConnection();
        var Pass = function(){return True;};
		var onReceive = function(raw_cmd_str, cmd){
			$('#debug_log').prepend('<div class = "msg">'+raw_cmd_str+'</div>');

			if (cmd.command === 'appendValue'){
				$('#result').prepend('<div class = "msg">'+cmd.value+'</div>');
			}
			else if (cmd.command === 'caution'){
				if(cmd.cause === 'logintUser'){
					$('#login_result').val() = 'failure.';
				}
			}
			else if (cmd.command === 'info'){
				$('#login').hide();
			}

		}
		var host_address = "192.168.11.27"
        con.connectToServer(host_address,4001,Pass,Pass,onReceive,Pass);
       
		$('#command').keyup(function(e){
			if (e.keyCode === 13){
				cmd = {
					command:'appendValue',
					value:$('#command').val()
				}
				con.sendCommand(cmd);
				$('#command').val("");
			}
		})

        $('#login_command').click(function(){
			con.loginUser($('#username').val(), $('#password').val());
			$('#command').val("");
        });

        $('#send_command').click(function(){
			cmd = {
				command:'appendValue',
				value:$('#command').val()
			}
			con.sendCommand(cmd);
			$('#command').val("");
        });
        
    });

})(jQuery);
</script>
<head>
<title>test</title>
</head>
<body>
<div id="login">
	<table>
		<tr><td>name:</td><td><input type="text" id="username"></td></tr><br />
		<tr><td>pass:</td><td><input type="password" id="password"><button id="login_command">login</button></td></tr><br />
	</table>
</div>
<div id="login_result"></div><br />
<br />
<textarea id="command"></textarea>
<button id="send_command">send</button>
<div id="result"></div><br />
<div id="debug_log"></div>
</body>
</html>
